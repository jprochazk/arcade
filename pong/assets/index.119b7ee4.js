var m=Object.defineProperty;var w=(n,t,s)=>t in n?m(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var h=(n,t,s)=>(w(n,typeof t!="symbol"?t+"":t,s),s);import{n as g}from"./vendor.39d0eea0.js";const F=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}};F();const d=(n,t,s)=>n+s*(t-n);class l{constructor(t,s){this.x=t,this.y=s}add(t){return new l(this.x+t.x,this.y+t.y)}sub(t){return new l(this.x-t.x,this.y-t.y)}len(){return Math.hypot(this.x,this.y)}clone(){return new l(this.x,this.y)}static lerp(t,s,e){return new l(d(t.x,s.x,e),d(t.y,s.y,e))}}const o=(n=0,t=0)=>new l(n,t);function a(n,t,s){return n<t?t:n>s?s:n}class y{constructor(t=o(0,0),s=o(0,0)){this.center=t,this.half=s}collide(t){const s=t.center.x-this.center.x,e=t.half.x+this.half.x-Math.abs(s),i=t.center.y-this.center.y,r=t.half.y+this.half.y-Math.abs(i);return e<=0||r<=0?null:e<r?o(-e*Math.sign(s),0):o(0,-r*Math.sign(i))}draw(t,s){t.save(),t.resetTransform(),t.translate(this.center.x,this.center.y),t.strokeStyle=s,t.strokeRect(-this.half.x,-this.half.y,this.half.x*2,this.half.y*2),t.restore()}}class b{constructor(t=o(0,0),s=1){this.center=t,this.radius=s}collide(t){const s=t,e=this,i=e.center,r=s.half,c=s.center,p=o(i.x-c.x,i.y-c.y),v=o(c.x+a(p.x,-r.x,r.x),c.y+a(p.y,-r.y,r.y)).sub(i),u=e.radius-v.len();return u>0?u:null}draw(t,s){t.save(),t.resetTransform(),t.translate(this.center.x,this.center.y),t.strokeStyle=s,t.beginPath(),t.arc(0,0,this.radius,0,Math.PI*2),t.strokeStyle="#FF00FF",t.stroke(),t.restore()}}class f{constructor(t,s,e,i){h(this,"game");h(this,"pos");h(this,"vel");h(this,"size");h(this,"color");h(this,"player");h(this,"top");h(this,"bottom");this.game=t;const r=o(s==="p1"?20:t.width()-20,t.height()/2);this.pos={prev:r.clone(),current:r.clone()},this.vel=o(),this.size=e.clone(),this.color=i,this.player=s,this.top=new y(o(r.x,r.y-e.y/4),o(e.x/2,e.y/4)),this.bottom=new y(o(r.x,r.y+e.y/4),o(e.x/2,e.y/4))}move(){this.vel.x=0,this.vel.y=0;const t=this.player==="p1"?this.game.keys.KeyW:this.game.keys.ArrowUp,s=this.player==="p1"?this.game.keys.KeyS:this.game.keys.ArrowDown;t&&(this.vel.y-=10),s&&(this.vel.y+=10),this.pos.prev=this.pos.current,this.pos.current=this.pos.current.add(this.vel),this.pos.current.y=a(this.pos.current.y,this.size.y/2,this.game.height()-this.size.y/2),this.top.center.y=this.pos.current.y-this.size.y/4,this.bottom.center.y=this.pos.current.y+this.size.y/4}draw(t){const s=this.game.ctx,e=l.lerp(this.pos.prev,this.pos.current,t);s.save(),s.resetTransform(),s.translate(e.x,e.y),s.fillStyle=this.color,s.fillRect(-this.size.x/2,-this.size.y/2,this.size.x,this.size.y),this.game.debug&&(this.top.draw(s,"#FF00FF"),this.bottom.draw(s,"#FF00FF")),s.restore()}reset(){const t=this.player==="p1"?o(20,this.game.height()/2):o(this.game.width()-20,this.game.height()/2);this.pos={prev:t.clone(),current:t.clone()},this.vel=o(),this.top.center=o(t.x,t.y-this.size.y/4),this.bottom.center=o(t.x,t.y+this.size.y/4)}}class k{constructor(t,s,e){h(this,"game");h(this,"pos");h(this,"vel");h(this,"speed");h(this,"radius");h(this,"color");h(this,"circle");this.game=t;const i=o(t.width()/2,t.height()/2);this.pos={prev:i.clone(),current:i.clone()},this.speed=7.5,this.vel=o((Math.random()>.5?1:-1)*this.speed,0),this.radius=s,this.color=e,this.circle=new b(i.clone(),s)}move(){this.pos.prev=this.pos.current,this.pos.current=this.pos.current.add(this.vel),this.circle.center=this.pos.current.clone()}score(){let t=null;return this.pos.current.y-this.radius<0&&(this.pos.current.y=this.radius,this.vel.y*=-1),this.pos.current.y+this.radius>this.game.height()&&(this.pos.current.y=this.game.height()-this.radius,this.vel.y*=-1),this.pos.current.x-this.radius<0&&(this.pos.current.x=this.radius,this.vel.x*=-1,t="p2"),this.pos.current.x+this.radius>this.game.width()&&(this.pos.current.x=this.game.width()-this.radius,this.vel.x*=-1,t="p1"),t&&(this.game.sounds.kuso.play(),this.speed+=.5,this.game.ctx.canvas.classList.add("shake"),setTimeout(()=>this.game.ctx.canvas.classList.remove("shake"),100)),t}bounce(t,s){const e=this.circle.collide(t.top),i=this.circle.collide(t.bottom),r=s==="p1"?1:-1;e!==null&&i!==null?e>i?(this.vel.x=r*this.speed,this.vel.y=-this.speed):(this.vel.x=r*this.speed,this.vel.y=this.speed):e!==null?(this.vel.x=r*this.speed,this.vel.y=-this.speed):i!==null&&(this.vel.x=r*this.speed,this.vel.y=this.speed),(e!==null||i!==null)&&(this.game.sounds.peko.play(),this.speed+=.5,this.game.ctx.canvas.classList.add("shake"),setTimeout(()=>this.game.ctx.canvas.classList.remove("shake"),100))}draw(t){const s=this.game.ctx,e=l.lerp(this.pos.prev,this.pos.current,t);s.save(),s.resetTransform(),s.translate(e.x,e.y),s.beginPath(),s.arc(0,0,this.radius,0,Math.PI*2),s.fillStyle=this.color,s.fill(),this.game.debug&&this.circle.draw(s,"#FF00FF"),s.restore()}reset(){const t=o(this.game.width()/2,this.game.height()/2);this.pos={prev:t.clone(),current:t.clone()},this.speed=7.5,this.vel=o((Math.random()>.5?1:-1)*this.speed,0),this.circle.center=t.clone()}}class T{constructor(t){h(this,"interval",-1);this.fn=t}start(t){this.interval=setInterval(()=>this.fn(),t)}stop(){clearInterval(this.interval)}}class S{constructor(t){h(this,"keys",{});h(this,"ctx");h(this,"clearColor","#000000");h(this,"sounds",{kuso:new Audio("./kuso.mp3"),peko:new Audio("./peko.ogg")});h(this,"ball");h(this,"p1");h(this,"p2");h(this,"playing",!0);h(this,"showVictoryText",!1);h(this,"victoryTextBlink");h(this,"score",{p1:0,p2:0});h(this,"winScore",10);h(this,"debug",!1);this.ctx=document.createElement("canvas").getContext("2d"),this.ctx.canvas.style.width="700px",this.ctx.canvas.style.height="600px",this.ctx.canvas.style.position="absolute",this.ctx.canvas.style.left="50%",this.ctx.canvas.style.top="50%",this.ctx.canvas.style.transform="translate(-50%, -50%)",t.appendChild(this.ctx.canvas),this.clear(),this.resize(),window.addEventListener("keydown",({code:s})=>this.keys[s]=!0),window.addEventListener("keyup",({code:s})=>this.keys[s]=!1),this.ball=new k(this,25,"#FFFFFF"),this.p1=new f(this,"p1",o(20,125),"#FFFFFF"),this.p2=new f(this,"p2",o(20,125),"#FFFFFF"),this.victoryTextBlink=new T(()=>this.showVictoryText=!this.showVictoryText)}update(){if(!this.playing){this.keys.Space&&this.reset();return}this.ball.move(),this.p1.move(),this.p2.move();const t=this.ball.score();t&&(this.score[t]+=1),this.win(),this.ball.bounce(this.p1,"p1"),this.ball.bounce(this.p2,"p2")}draw(t){this.playing||(t=0),this.resize(),this.clear(),this.p1.draw(t),this.p2.draw(t),this.ball.draw(t),this.drawScore(),this.drawVictory()}drawScore(){const t=this.ctx,s=`${this.score.p1} | ${this.score.p2}`;t.save(),t.resetTransform(),t.translate(this.width()/2,75),t.fillStyle="#FFFFFF",t.font="16px monospace",t.fillText(s,-t.measureText(s).width/2,0),t.restore()}win(){let t=null;this.score.p1===this.winScore&&(t="p1"),this.score.p2===this.winScore&&(t="p2"),t&&(this.playing=!1,this.showVictoryText=!0,this.victoryTextBlink.start(500))}reset(){this.ball.reset(),this.p1.reset(),this.p2.reset(),this.victoryTextBlink.stop(),this.showVictoryText=!1,this.score.p1=0,this.score.p2=0,this.playing=!0}drawVictory(){if(!this.showVictoryText)return;const t=this.ctx,s=`${this.score.p1>this.score.p2?"Left":"Right"} paddle won!`;t.save(),t.resetTransform(),t.translate(this.width()/2,this.height()/2),t.fillStyle="#FFFFFF",t.font="32px monospace",t.fillText(s,-t.measureText(s).width/2,0),t.restore()}width(){return this.ctx.canvas.width}height(){return this.ctx.canvas.height}resize(){const t=this.ctx.canvas;(t.clientWidth!==t.width||t.clientHeight!==t.height)&&(t.width=t.clientWidth,t.height=t.clientHeight)}clear(){const t=this.ctx,s=t.fillStyle;t.fillStyle=this.clearColor,t.fillRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=s}}const L=document.querySelector("#app"),x=new S(L);g(30,()=>x.update(),n=>x.draw(n));
